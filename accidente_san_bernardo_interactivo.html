<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Accidente ferroviario San Bernardo – Visualización interactiva</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Leaflet Extra Plugins -->
<script src="https://unpkg.com/esri-leaflet@3.0.12/dist/esri-leaflet.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #F5F5F5;
}

#map {
  width: 40%;
  height: 100vh;
}

#panel {
  position: fixed;
  top: 0;
  right: -420px;
  width: 420px;
  height: 100vh;
  background: #FFFFFF;
  border-left: 3px solid #D90429;
  padding: 20px;
  overflow-y: auto;
  transition: 0.4s;
}

#panel.show {
  right: 0;
}

h2 {
  color: #D90429;
}

.photo {
  width: 40%;
  margin-bottom: 15px;
  border-radius: 5px;
}

.metro-line {
  stroke: #D90429;
  stroke-width: 5px;
}

.leaflet-marker-icon.accidente {
  animation: pulse 1.8s infinite;
}

@keyframes pulse {
  0% {transform: scale(1);}
  50% {transform: scale(1.4);}
  100% {transform: scale(1);}
}
</style>

</head>
<body>

<div id="map"></div>

<div id="panel">
  <h2>Accidente ferroviario San Bernardo</h2>
  <img class="photo" src="https://static.theclinic.cl/media/2024/06/20-151152_aciv_Diseno-sin-titulo-37-1200x648.png">
  <img class="photo" src="https://www.t13.cl/sites/default/files/styles/manual_crop_16_9/public/field/image/choque-trenes-san-bernardo.jpeg">
  <img class="photo" src="https://elperiodico.cl/wp-content/uploads/2024/06/Choque-de-trenes-689x392.jpeg">

  <p><b>Resumen:</b><br>
  El 20 de junio de 2024, un tren de pruebas EFE colisionó de frente con un tren de carga Fepasa entre Lo Blanco y Lo Herrera.
  El accidente dejó dos maquinistas fallecidos y nueve heridos, y abrió el debate sobre fallas en los protocolos de autorización de vía.</p>
</div>

<script>
// --- MAPA ---
var map = L.map('map').setView([-33.60, -70.705], 12);

// Fondo simple para modo Metro
L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
  opacity: 0.4
}).addTo(map);

// --- Datos de estaciones ---
var estaciones = [
  [-33.4513, -70.6797],
  [-33.4660, -70.6899],
  [-33.4919, -70.6951],
  [-33.5150, -70.6988],
  [-33.5465, -70.7000],
  [-33.5866, -70.6980],
  [-33.5994, -70.7009],
  [-33.6183, -70.7072],
  [-33.6378, -70.7189],
  [-34.1701, -70.7444]
];

var accidente = [-33.6069, -70.7040];

// --- Dibuja línea estilo Metro ---
var poly = L.polyline(estaciones, {
  color: "#D90429",
  weight: 6
}).addTo(map);

// --- Dibuja estaciones ---
estaciones.forEach(function(coord){
  L.circleMarker(coord, {
    radius: 8,
    fillColor: "#FFFFFF",
    color: "#121212",
    weight: 2,
    fillOpacity: 1
  }).addTo(map);
});

// --- Marcador del accidente ---
var accMarker = L.circleMarker(accidente, {
  radius: 12,
  fillColor: "#D90429",
  color: "#FFFFFF",
  weight: 3,
  fillOpacity: 1,
  className: "accidente"
}).addTo(map);

// --- Al hacer clic → se abre panel con mapa satelital ESRI ---
accMarker.on("click", function(){
  document.getElementById("panel").classList.add("show");

  // Cambia a fondo satelital ESRI
  L.esri.basemapLayer("Imagery").addTo(map);
  map.flyTo(accidente, 16);
});
</script>
</body>
</html>
